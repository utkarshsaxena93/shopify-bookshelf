<% content_for :head do %>
  <title>ShopifyBookshelf</title>
  <%= stylesheet_link_tag    'homepage', media: 'all' %>
<% end %>


<h1>Welcome to Shopify's Bookshelf</h1>
<% if current_user %>
<div class="row">
  <div class="col-lg-8">
    <%= render 'form' %>
  </div>
</div>
<% end %>

<div class="row">
  <div class="col-lg-8">
    <% @stories.each do |story| %>
      <div class="well well-lg">
        <h2><%= link_to story.title, story_path(story) %></h2>

        <p><%= truncate(story.body, length: 350) %></p>

        <p>
          Added by: <%= story.user.email %>
        </p>
        <% if current_user %>
          <p>
            <span class="label label-default"><%= pluralize(story.likes.count, 'like') %></span>
            <%= link_to content_tag(:span, '', class: 'glyphicon glyphicon-thumbs-up') + ' Like it',
                         like_story_path(story), class: 'btn btn-default btn-sm',
                         method: :post, disabled: (if story.likes[0] then story.likes[0].user_id == current_user.id end) %>
          </p>
        <% end %>

        <% if story.user == current_user %>
          <div class="btn-group">
            <%= link_to 'Edit', edit_story_path(story), class: 'btn btn-info' %>
            <%= link_to 'Delete', story_path(story), data: {confirm: 'Are you sure?'}, method: :delete, class: 'btn btn-danger' %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="col-lg-4">
    <%= render 'shared/activities' %>
  </div>
</div>

<% content_for :scripts do %>
  <%= javascript_include_tag 'homepage' %>
<% end %>
